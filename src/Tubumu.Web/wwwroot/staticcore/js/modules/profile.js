webpackJsonp([5],{"+Ye7":function(e,t){},"/rEA":function(e,h,w){"use strict";(function(r){var e=w("//Fk"),n=w.n(e),t=w("mvHQ"),a=w.n(t),o=w("OvRC"),i=w.n(o),s=w("mtWM"),l=w.n(s),u=w("mw3O"),d=w.n(u),c=w("bzuE"),f="default",p="sysetem";function g(e,t,a){this.name="ApiError",this.message=e||"Default Message",this.errorType=t||f,this.innerError=a,this.stack=(new Error).stack}(g.prototype=i()(Error.prototype)).constructor=g;var m=l.a.create({baseURL:c.a,timeout:2e4,responseType:"json",withCredentials:!0});m.interceptors.request.use(function(e){return"post"===e.method||"put"===e.method||"patch"===e.method?(e.headers={"Content-Type":"application/json; charset=UTF-8"},e.data=a()(e.data)):"delete"!==e.method&&"get"!==e.method&&"head"!==e.method||(e.paramsSerializer=function(e){return d.a.stringify(e,{arrayFormat:"indices"})}),localStorage.token&&(e.headers.Authorization="Bearer "+localStorage.token),e},function(e){return e}),m.interceptors.response.use(function(e){if(-1===e.headers["content-type"].indexOf("json"))return e;var t=void 0;if("arraybuffer"===e.request.responseType&&"[object ArrayBuffer]"===e.data.toString()){var a=r.from(e.data).toString("utf8");t=JSON.parse(a)}else t=e.data;if(t){if(t.data&&(t.data.token&&(localStorage.token=t.data.token),t.data.refreshToken&&(localStorage.refreshToken=t.data.refreshToken)),t.url)return void(top.location=t.url);if(200!==t.code)return console.log(t),n.a.reject(new g(t.message))}return e},function(e){if(console.log(e.response.headers),401===e.response.status){if(-1!==e.response.headers["content-type"].indexOf("json")&&e.response.data.url)return void(top.location=e.response.data.url);if(e.response.headers["token-expired"]&&localStorage.token&&localStorage.refreshToken){console.log("Refresh Token");var t={token:localStorage.token,refreshToken:localStorage.refreshToken};return localStorage.removeItem("token"),localStorage.removeItem("refreshToken"),m.post("/admin/refreshToken",t),n.a.reject(new g("登录超时，自动登录中......",p,e))}}return n.a.reject(new g(e.message,p,e))}),h.a={install:function(e,t){e.httpClient=m,e.prototype.$httpClient=m}}}).call(h,w("EuP9").Buffer)},"9WZl":function(e,t,a){"use strict";var r={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-container",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:t.isLoading,expression:"isLoading",modifiers:{fullscreen:!0,lock:!0}}]},[a("el-header",{staticClass:"header"},[a("el-breadcrumb",{staticClass:"breadcrumb",attrs:{"separator-class":"el-icon-arrow-right"}},[a("el-breadcrumb-item",[t._v("我的资料")])],1)],1),t._v(" "),a("el-main",{staticClass:"main"},[a("el-tabs",{attrs:{type:"card"},model:{value:t.activeTabName,callback:function(e){t.activeTabName=e},expression:"activeTabName"}},[a("el-tab-pane",{attrs:{label:"修改资料",name:"pane01"}},[a("el-form",{ref:"changeProfileForm",attrs:{model:t.changeProfileForm,rules:t.changeProfileFormRules,"label-position":"right","label-width":"120px"}},[a("el-form-item",{attrs:{label:"昵称",prop:"displayName"}},[a("el-input",{ref:"displayName",attrs:{"auto-complete":"off",placeholder:"请输入昵称"},model:{value:t.changeProfileForm.displayName,callback:function(e){t.$set(t.changeProfileForm,"displayName","string"==typeof e?e.trim():e)},expression:"changeProfileForm.displayName"}})],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.handleChangeProfile}},[t._v("修改资料")])],1)],1)],1),t._v(" "),a("el-tab-pane",{attrs:{label:"修改头像",name:"pane02"}},[a("el-upload",{ref:"avatarUploader",staticClass:"uploader",attrs:{action:"","auto-upload":!0,"show-file-list":!1,"before-upload":t.beforeUpload,"http-request":t.uploadAvatar}},[t.uploadImageAvatarPreviewUrl?a("img",{staticClass:"uploaderPreview",attrs:{src:t.uploadImageAvatarPreviewUrl}}):a("i",{staticClass:"el-icon-plus uploader-icon"})])],1),t._v(" "),a("el-tab-pane",{attrs:{label:"修改 Logo",name:"pane03"}},[a("el-upload",{ref:"logoUploader",staticClass:"uploader",attrs:{action:"","auto-upload":!0,"show-file-list":!1,"before-upload":t.beforeUpload,"http-request":t.uploadLogo}},[t.uploadImageLogoPreviewUrl?a("img",{staticClass:"uploaderPreview",attrs:{src:t.uploadImageLogoPreviewUrl}}):a("i",{staticClass:"el-icon-plus uploader-icon"})])],1),t._v(" "),a("el-tab-pane",{attrs:{label:"修改密码",name:"pane04"}},[a("el-form",{ref:"changePasswordForm",attrs:{model:t.changePasswordForm,rules:t.changePasswordFormRules,"label-position":"right","label-width":"120px"}},[a("el-form-item",{attrs:{label:"当前密码",prop:"currentPassword"}},[a("el-input",{ref:"currentPassword",attrs:{type:"password","auto-complete":"off",placeholder:"请输入当前密码"},model:{value:t.changePasswordForm.currentPassword,callback:function(e){t.$set(t.changePasswordForm,"currentPassword","string"==typeof e?e.trim():e)},expression:"changePasswordForm.currentPassword"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"新密码",prop:"newPassword"}},[a("el-input",{ref:"newPassword",attrs:{type:"password","auto-complete":"off",placeholder:"请输入新密码"},model:{value:t.changePasswordForm.newPassword,callback:function(e){t.$set(t.changePasswordForm,"newPassword","string"==typeof e?e.trim():e)},expression:"changePasswordForm.newPassword"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"确认新密码",prop:"newPasswordConfirm"}},[a("el-input",{ref:"newPasswordConfirm",attrs:{type:"password","auto-complete":"off",placeholder:"请确认新密码"},model:{value:t.changePasswordForm.newPasswordConfirm,callback:function(e){t.$set(t.changePasswordForm,"newPasswordConfirm","string"==typeof e?e.trim():e)},expression:"changePasswordForm.newPasswordConfirm"}})],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.handleChangePassword}},[t._v("修改密码")])],1)],1)],1)],1)],1)],1)},staticRenderFns:[]};t.a=r},IV7n:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("tvR6"),n=(a.n(r),a("qBF2")),o=a.n(n),i=a("7+uW"),s=a("/rEA"),l=a("MJwJ"),u=a("uN2V"),d=(a.n(u),a("tqSN"));i.default.config.productionTip=!1,i.default.use(s.a),i.default.use(l.a),i.default.use(o.a,{size:"mini"}),new i.default({el:"#app",render:function(e){return e(d.a)}})},MJwJ:function(e,f,p){"use strict";(function(r){var e=p("//Fk"),n=p.n(e),t=p("OvRC"),a=p.n(t),o=p("mtWM"),i=p.n(o),s=p("bzuE"),l="default",u="sysetem";function d(e,t,a){this.name="ApiError",this.message=e||"Default Message",this.errorType=t||l,this.innerError=a,this.stack=(new Error).stack}(d.prototype=a()(Error.prototype)).constructor=d;var c=i.a.create({baseURL:s.a,timeout:2e4,responseType:"json",withCredentials:!0});c.interceptors.request.use(function(e){return"post"===e.method&&(e.headers={"Content-Type":"multipart/form-data"}),localStorage.token&&(e.headers.Authorization="Bearer "+localStorage.token),e},function(e){return e}),c.interceptors.response.use(function(e){if(-1===e.headers["content-type"].indexOf("json"))return e;var t=void 0;if("arraybuffer"===e.request.responseType&&"[object ArrayBuffer]"===e.data.toString()){var a=r.from(e.data).toString("utf8");t=JSON.parse(a)}else t=e.data;return t&&(t.data&&(t.data.token&&(localStorage.token=t.data.token),t.data.refreshToken&&(localStorage.refreshToken=t.data.refreshToken)),200!==t.code)?(console.log(t),n.a.reject(new d(t.message))):e},function(e){if(console.log(e.response.headers),401===e.response.status){if(-1!==e.response.headers["content-type"].indexOf("json")&&e.response.data.url)return void(top.location=e.response.data.url);if(e.response.headers["token-expired"]&&localStorage.token&&localStorage.refreshToken){console.log("Refresh Token");var t={token:localStorage.token,refreshToken:localStorage.refreshToken};return localStorage.removeItem("token"),localStorage.removeItem("refreshToken"),c.post("/admin/refreshToken",t),n.a.reject(new d("登录超时，自动登录中......",u,e))}}return n.a.reject(new d(e.message,u,e))}),f.a={install:function(e,t){e.uploadHttpClient=c,e.prototype.$uploadHttpClient=c}}}).call(f,p("EuP9").Buffer)},VsUZ:function(e,t,a){"use strict";var r=a("7+uW");t.a={login:function(e){return r.default.httpClient.post("/admin/login",e)},refreshToken:function(e){return r.default.httpClient.post("/admin/refreshToken",e)},logout:function(){return r.default.httpClient.post("/admin/logout")},getProfile:function(){return r.default.httpClient.get("/admin/getProfile")},changeProfile:function(e){return r.default.httpClient.post("/admin/changeProfile",e)},changeAvatar:function(e){return r.default.uploadHttpClient.post("/admin/ChangeAvatar",e)},changeLogo:function(e){return r.default.uploadHttpClient.post("/admin/ChangeLogo",e)},changePassword:function(e){return r.default.httpClient.post("/admin/changePassword",e)},getMenus:function(){return r.default.httpClient.get("/admin/getMenus")},getBulletin:function(){return r.default.httpClient.get("/admin/getBulletin")},editBulletin:function(e){return r.default.httpClient.post("/admin/editBulletin",e)},getModuleMetaDatas:function(){return r.default.httpClient.get("/admin/getModuleMetaDatas")},extractModuleMetaDatas:function(){return r.default.httpClient.get("/admin/extractModuleMetaDatas")},clearModulePermissions:function(){return r.default.httpClient.get("/admin/clearModulePermissions")},getRoleList:function(){return r.default.httpClient.get("/admin/getRoleList")},addRole:function(e){return r.default.httpClient.post("/admin/addRole",e)},editRole:function(e){return r.default.httpClient.post("/admin/editRole",e)},removeRole:function(e){return r.default.httpClient.post("/admin/removeRole",e)},moveRole:function(e){return r.default.httpClient.post("/admin/moveRole",e)},saveRoleName:function(e){return r.default.httpClient.post("/admin/saveRoleName",e)},getGroupTree:function(){return r.default.httpClient.get("/admin/getGroupTree")},addGroup:function(e){return r.default.httpClient.post("/admin/addGroup",e)},editGroup:function(e){return r.default.httpClient.post("/admin/editGroup",e)},removeGroup:function(e){return r.default.httpClient.post("/admin/removeGroup",e)},moveGroup:function(e){return r.default.httpClient.post("/admin/moveGroup",e)},getUserPage:function(e){return r.default.httpClient.post("/admin/getUserPage",e)},addUser:function(e){return r.default.httpClient.post("/admin/addUser",e)},editUser:function(e){return r.default.httpClient.post("/admin/editUser",e)},removeUser:function(e){return r.default.httpClient.post("/admin/removeUser",e)},getUserStatuList:function(){return r.default.httpClient.get("/admin/getUserStatuList")},validateUsernameExists:function(e){return r.default.httpClient.post("/admin/ValidateUsernameExists",e)},validateMobileExists:function(e){return r.default.httpClient.post("/admin/ValidateMobileExists",e)},validateEmailExists:function(e){return r.default.httpClient.post("/admin/ValidateEmailExists",e)},changeUserAvatar:function(e){return r.default.uploadHttpClient.post("/admin/ChangeUserAvatar",e)},changeUserLogo:function(e){return r.default.uploadHttpClient.post("/admin/ChangeUserLogo",e)},getNotificationsForManager:function(e){return r.default.httpClient.post("/admin/getNotificationsForManager",e)},addNotification:function(e){return r.default.httpClient.post("/admin/addNotification",e)},editNotification:function(e){return r.default.httpClient.post("/admin/editNotification",e)},removeNotification:function(e){return r.default.httpClient.post("/admin/removeNotification",e)},getNotifications:function(e){return r.default.httpClient.post("/admin/getNotifications",e)},readNotifications:function(e){return r.default.httpClient.post("/admin/readNotifications",e)},deleteNotifications:function(e){return r.default.httpClient.post("/admin/deleteNotifications",e)},getNewestNotification:function(e){return r.default.httpClient.post("/admin/getNewestNotification",e)},getGroupList:function(){return r.default.httpClient.get("/admin/getGroupList")},getRoleBaseList:function(){return r.default.httpClient.get("/admin/getRoleBaseList")},getPermissionTree:function(){return r.default.httpClient.get("/admin/getPermissionTree")},callDirectly:function(e){return r.default.httpClient.get(e)},download:function(e,t){return r.default.httpClient.post(e,t,{responseType:"arraybuffer"})}}},bzuE:function(e,t,a){"use strict";a.d(t,"a",function(){return r}),a.d(t,"b",function(){return n}),a.d(t,"c",function(){return o});var r="/api",n="",o=""},tqSN:function(e,t,a){"use strict";var r=a("xuOk"),n=a("9WZl");function o(e){a("+Ye7")}var i=a("VU/8")(r.a,n.a,!1,o,null,null);t.a=i.exports},tvR6:function(e,t){},uN2V:function(e,t){},xuOk:function(e,t,a){"use strict";var r=a("VsUZ"),n=a("NC6I"),o=a.n(n);t.a={data:function(){return{isLoading:!1,activeTabName:"pane01",uploadImageAvatarPreviewUrl:null,uploadImageLogoPreviewUrl:null,changeProfileForm:{displayName:null},changeProfileFormRules:{displayName:[{max:20,message:"最多支持20个字符",trigger:"blur"},{pattern:/^[a-zA-Z\u4E00-\u9FA5\uF900-\uFA2D][a-zA-Z0-9-_\u4E00-\u9FA5\uF900-\uFA2D]*$/,message:"昵称包含非法字符",trigger:"blur"}]},changePasswordForm:{currentPassword:null,newPassword:null,newPasswordConfirm:null},changePasswordFormRules:{currentPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"},{min:6,message:"最少支持6个字符",trigger:"blur"},{max:32,message:"最多支持32个字符",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"最少支持6个字符",trigger:"blur"},{max:32,message:"最多支持32个字符",trigger:"blur"}],newPasswordConfirm:[{required:!0,message:"请确认新密码",trigger:"blur"},{min:6,message:"最少支持6个字符",trigger:"blur"},{max:32,message:"最多支持32个字符",trigger:"blur"}]}}},mounted:function(){this.getProfile()},methods:{getProfile:function(){var a=this;this.isLoading=!0,r.a.getProfile().then(function(e){a.isLoading=!1;var t=e.data.data;a.changeProfileForm.displayName=t.displayName,a.uploadImageAvatarPreviewUrl=t.avatarUrl+"?"+(new Date).getTime(),a.uploadImageLogoPreviewUrl=t.logoUrl+"?"+(new Date).getTime()},function(e){a.isLoading=!1,a.$message.error(e.message)})},handleChangeProfile:function(){var a=this;this.$refs.changeProfileForm.validate(function(e){if(!e)return!1;a.isLoading=!0;var t=a.changeProfileForm;r.a.changeProfile(t).then(function(e){a.isLoading=!1,a.$message.success(e.data.message)},function(e){a.isLoading=!1,a.$message.error(e.message)})})},handleChangePassword:function(){var a=this;this.$refs.changePasswordForm.validate(function(e){if(!e)return!1;a.isLoading=!0;var t={currentPassword:o()(a.changePasswordForm.currentPassword),newPassword:o()(a.changePasswordForm.newPassword),newPasswordConfirm:o()(a.changePasswordForm.newPasswordConfirm)};r.a.changePassword(t).then(function(e){a.isLoading=!1,a.changePasswordForm.currentPassword=null,a.changePasswordForm.newPassword=null,a.changePasswordForm.newPasswordConfirm=null,a.$message.success(e.data.message)},function(e){a.isLoading=!1,a.$message.error(e.message)})})},handleChangeAvatarUrlBrowser:function(){this.popupFileManager("avatarUrl")},handleChangeLogoUrlBrowser:function(){this.popupFileManager("logoUrl")},popupFileManager:function(a){var r=this;try{CKFinder.popup({chooseFiles:!0,width:800,height:600,onInit:function(e){e.on("files:choose",function(e){var t=e.data.files.first();r.changeProfileForm[a]=t.getUrl()}),e.on("file:choose:resizedImage",function(e){r.changeProfileForm[a]=e.data.resizedUrl})}})}catch(e){console.log(e.message)}},beforeUpload:function(e){console.log("beforeUpload");var t="image/jpeg"===e.type||"image/png"===e.type,a=e.size/1024/1024<1;return t||this.$message.error("上传图片只能是 JPG 或 PNG 格式"),a||this.$message.error("上传图片大小不能超过 1MB"),t&&a},uploadAvatar:function(e){var t=this;this.isLoading=!0;var a=new FormData;a.append("file",e.file),r.a.changeAvatar(a).then(function(e){t.isLoading=!1,t.uploadImageAvatarPreviewUrl=e.data.url+"?"+(new Date).getTime()},function(e){t.isLoading=!1,t.$message.error(e.message)})},uploadLogo:function(e){var t=this;this.isLoading=!0;var a=new FormData;a.append("file",e.file),r.a.changeLogo(a).then(function(e){t.isLoading=!1,t.uploadImageLogoPreviewUrl=e.data.url+"?"+(new Date).getTime()},function(e){t.isLoading=!1,t.$message.error(e.message)})}}}}},["IV7n"]);
//# sourceMappingURL=profile.js.map